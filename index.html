<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø£Ø­Ù…Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet" />
<style>
body {
  font-family: 'Cairo', sans-serif;
  margin: 0;
  background: linear-gradient(to bottom, #fff7c2, #a3d4ff);
  color: #003366;
}
.page {
  display: none;
  padding: 20px;
  animation: fade 0.5s ease;
}
@keyframes fade { from {opacity:0;} to {opacity:1;} }
.active { display: block; }
button {
  width: 100%;
  padding: 14px;
  margin: 10px 0;
  border: none;
  border-radius: 12px;
  background: linear-gradient(45deg, #ffd84d, #79b7ff);
  font-size: 18px;
  cursor: pointer;
  font-weight: bold;
  color: #003366;
  transition: 0.2s;
}
button:hover { transform: scale(1.03); }
.quiz-card {
  background: white;
  padding: 20px;
  border-radius: 18px;
  box-shadow: 0px 4px 12px #0002;
  border: 3px solid #ffdd66;
}
.progress-bar {
  height: 18px;
  width: 100%;
  background: #e0e0e0;
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 20px;
}
.progress {
  height: 100%;
  width: 0%;
  background: #4da3ff;
  transition: width 0.4s ease;
}
.explanation {
  background: #fff7c2;
  padding: 10px;
  border-radius: 10px;
  border: 2px solid #ffd84d;
  margin-top: 15px;
}
</style>
</head>
<body>

<!-- Ø§Ù„ØµÙØ­Ø© 1: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø§Ø¯Ø© -->
<div id="page-subjects" class="page active">
  <h1>Ù…Ø±Ø­Ø¨Ù‹Ø§ ÙŠØ§ Ø£Ø­Ù…Ø¯ Ø±Ø§Ù…ÙŠ ğŸ‘‹</h1>
  <h2>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</h2>
  <div id="subjects"></div>
</div>

<!-- Ø§Ù„ØµÙØ­Ø© 2: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒÙˆÙŠØ² -->
<div id="page-lessons" class="page">
  <button onclick="goTo('page-subjects')">â¬… Ø±Ø¬ÙˆØ¹</button>
  <h2 id="chosen-subject-title"></h2>
  <div id="lessons"></div>
</div>

<!-- Ø§Ù„ØµÙØ­Ø© 3: Ø§Ù„ÙƒÙˆÙŠØ² -->
<div id="page-quiz" class="page">
  <button onclick="goTo('page-lessons')">â¬… Ø±Ø¬ÙˆØ¹</button>
  <div class="progress-bar"><div id="progress" class="progress"></div></div>
  <div id="quiz-box" class="quiz-card">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</div>
</div>

<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRcWDsX4R4gqmGyWpFqA7WuzQvI-ajwYIJz12rvyj9fJyJ24FXkvdjlES87PvB0Umb4FpJCFCbCO1n_/pub?gid=0&single=true&output=csv";

let questions = [];
let filtered = [];
let currentQ = 0;
let score = 0;
let wrong = [];
let subjectSelected = "";
let lessonSelected = "";

function goTo(page){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(page).classList.add('active');
}

async function loadCSV(){
  const res = await fetch(csvUrl);
  const csv = await res.text();
  const rows = csv.trim().split('\n').map(r=>r.split(','));
  const headers = rows.shift();
  questions = rows.map(r=>{
    let q={}; headers.forEach((h,i)=> q[h]=r[i]||""); return q;
  });

  const subjects = [...new Set(questions.map(q=>q.Subject))];
  document.getElementById('subjects').innerHTML = subjects.map(s =>
    `<button onclick=\"selectSubject('${s}')\">${s}</button>`
  ).join('');
}

function selectSubject(sub){
  subjectSelected = sub;
  document.getElementById('chosen-subject-title').innerHTML = `ğŸ“˜ Ù…Ø§Ø¯Ø©: ${sub}`;
  const lessons = [...new Set(questions.filter(q=>q.Subject===sub).map(q=>q.Lesson))];
  document.getElementById('lessons').innerHTML = lessons.map(l =>
    `<button onclick=\"startQuiz('${sub}','${l}')\">${l}</button>`
  ).join('');
  goTo('page-lessons');
}

function startQuiz(sub, les){
  subjectSelected=sub;
  lessonSelected=les;
  filtered = questions.filter(q=>q.Subject===sub && q.Lesson===les);
  currentQ = 0;
  score = 0;
  wrong = [];
  goTo('page-quiz');
  showQuestion();
}

function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; }
  return arr;
}

function showQuestion(){
  if(currentQ>=filtered.length) return finishQuiz();

  const q = filtered[currentQ];
  const answers = shuffle([q.Right,q.Wrong1,q.Wrong2,q.Wrong3]);

  document.getElementById('progress').style.width = `${(currentQ/filtered.length)*100}%`;

  document.getElementById('quiz-box').innerHTML = `
    <h3>${q.Question}</h3>
    ${answers.map(a => `
      <button onclick=\"checkAnswer('${a.replace(/'/g, "\\'")}')\">${a}</button>
    `).join('')} 
    <div id='exp'></div>
  `;
}

function checkAnswer(ans){
  const q = filtered[currentQ];
  const exp = document.getElementById('exp');

  if(ans === q.Right){
    score++;
    exp.innerHTML = `<div class='explanation'>âœ… Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!<br>${q.Explanation}</div>`;
  } else {
    wrong.push({q:q.Question, y:ans, c:q.Right});
    exp.innerHTML = `<div class='explanation'>âŒ Ø®Ø·Ø£!<br>${q.Explanation}</div>`;
  }

  const next = document.createElement('button');
  next.textContent = "Ø§Ù„ØªØ§Ù„ÙŠ";
  next.onclick = ()=>{ currentQ++; showQuestion(); };
  exp.appendChild(next);
}

function finishQuiz(){
  document.getElementById('progress').style.width = "100%";

  document.getElementById('quiz-box').innerHTML = `
    <h2>ğŸ“Š Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h2>
    <p>${score} Ù…Ù† ${filtered.length}</p>
    <h3>Ø§Ù„Ø£Ø®Ø·Ø§Ø¡:</h3>
    <ul>${wrong.map(w=>`<li>${w.q}<br>Ø¥Ø¬Ø§Ø¨ØªÙƒ: ${w.y}<br>Ø§Ù„ØµØ­ÙŠØ­Ø©: ${w.c}</li>`).join('')}</ul>
    <button onclick=\"goTo('page-lessons')\">Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¯Ø±ÙˆØ³</button>
  `;
}

loadCSV();
</script>
</body>
</html>
