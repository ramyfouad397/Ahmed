<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÙƒÙˆÙŠØ² Ø§Ù„Ø£Ø·ÙØ§Ù„ - Ø£Ø­Ù…Ø¯</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
body {
  font-family: 'Cairo', sans-serif;
  background: linear-gradient(to bottom, #fff7c2, #a3d4ff);
  margin: 0; padding: 0;
  display: flex; flex-direction: column; align-items: center;
  color:#003366; overflow-x:hidden;
}
.bubble { position:absolute; background:rgba(255,255,255,0.3); border-radius:50%; animation:floatUp 10s infinite ease-in-out; }
@keyframes floatUp { 0%{transform:translateY(0) scale(1);} 100%{transform:translateY(-800px) scale(1.5);} }
.container { width:95%; max-width:650px; margin-top:30px; }
.quiz-card { background:#fff; border-radius:20px; padding:25px; margin:20px auto; box-shadow:0 6px 20px rgba(0,0,0,0.2); border:3px solid #ffdd66; }
button {
  background: linear-gradient(45deg,#ffd84d,#79b7ff);
  border:none; padding:14px 22px; border-radius:14px;
  cursor:pointer; transition:0.2s; margin-top:15px;
  font-size:18px; font-weight:bold; color:#003366;
}
button:hover{ transform:scale(1.07); }
.answers button{ width:100%; margin:10px 0; background:linear-gradient(45deg,#fff099,#7cc3ff);} 
.report-item{ background:white; padding:12px; border-radius:12px; margin-bottom:10px; border:2px solid #b5d9ff; }
.progress-bar { width:100%; background:#e0e0e0; border-radius:10px; height:18px; margin-top:10px; }
.progress-fill { height:100%; background:#ffd84d; border-radius:10px; width:0%; transition:0.5s; }
</style>
</head>
<body>
<script>
for(let i=0;i<15;i++){
  const b=document.createElement('div'); b.className='bubble';
  let size=Math.random()*40+20;
  b.style.width=size+'px'; b.style.height=size+'px';
  b.style.left=Math.random()*100+'%'; b.style.bottom='-100px';
  b.style.animationDuration=(Math.random()*10+5)+'s';
  document.body.appendChild(b);
}
</script>
<div class="container">
  <button onclick="showAllReports()" style="width:100%;font-size:20px;">ğŸ“˜ Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
  <div id="quiz" class="quiz-card">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©...</div>
</div>
<audio id="rankUpSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_7b42b1e8c8.mp3?filename=correct-answer-^6.mp3"></audio>
<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRcWDsX4R4gqmGyWpFqA7WuzQvI-ajwYIJz12rvyj9fJyJ24FXkvdjlES87PvB0Umb4FpJCFCbCO1n_/pub?gid=0&single=true&output=csv";
let questions=[], subjects=[], lessons=[], filtered=[], currentQ=0, score=0, wrongQuestions=[];
let selectedSubject="", selectedLesson="";

function calculateRank(count){
  const ranks=["ğŸ“˜ Ù…Ø¬Ù†Ø¯","ğŸ“— Ø¹Ø±ÙŠÙ","ğŸ“™ Ø±Ù‚ÙŠØ¨","ğŸ“• Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„","ğŸ–ï¸ Ù…Ù„Ø§Ø²Ù…","ğŸ–ï¸ Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„","ğŸŒŸ Ù†Ù‚ÙŠØ¨","ğŸŒŸ Ø±Ø§Ø¦Ø¯","â­ Ù…Ù‚Ø¯Ù…","â­ Ø¹Ù‚ÙŠØ¯","ğŸ’  Ø¹Ù…ÙŠØ¯","ğŸ’  Ù„ÙˆØ§Ø¡","ğŸ… ÙØ±ÙŠÙ‚","ğŸ… ÙØ±ÙŠÙ‚ Ø£ÙˆÙ„","ğŸ–ï¸ Ù…Ø´ÙŠØ±"];
  return ranks[Math.min(Math.floor(count/10), ranks.length-1)];
}

async function loadQuestions(){
  try{
    const res=await fetch(csvUrl);
    const csv=await res.text();
    const rows=csv.trim().split("\n").map(r=>r.split(","));
    const headers=rows.shift();
    questions=rows.map(row=>{let q={}; headers.forEach((h,i)=>q[h.trim()]=row[i]?row[i].trim():""); return q;});
    subjects=[...new Set(questions.map(q=>q.Subject))];
    showSubjectSelect();
  }catch(e){ document.getElementById('quiz').innerHTML='âŒ Ù„Ù… ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø£Ø³Ø¦Ù„Ø©.'; }
}

function showSubjectSelect(){
  const quizDiv=document.getElementById('quiz');
  quizDiv.innerHTML=`<h2>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</h2>${subjects.map(s=>`<button onclick="selectSubject('${s}')">${s}</button>`).join('')}`;
}

function selectSubject(subject){
  selectedSubject=subject;
  lessons=[...new Set(questions.filter(q=>q.Subject===subject).map(q=>q.Lesson))];
  const quizDiv=document.getElementById('quiz');
  quizDiv.innerHTML=`<h2>${subject}</h2><h3>Ø§Ø®ØªØ± Ø§Ù„Ø¯Ø±Ø³</h3>${lessons.map(l=>`<button onclick="startLesson('${subject}','${l}')">${l}</button>`).join('')}`;
}

function startLesson(subject,lesson){
  selectedSubject=subject; selectedLesson=lesson;
  filtered=questions.filter(q=>q.Subject===subject && q.Lesson===lesson);
  currentQ=0; score=0; wrongQuestions=[];
  showQuestion();
}

function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }

function showQuestion(){
  const quizDiv=document.getElementById('quiz');
  if(currentQ>=filtered.length) return showReport();
  const q=filtered[currentQ];
  const answers=shuffle([q.Right,q.Wrong1,q.Wrong2,q.Wrong3]);
  quizDiv.innerHTML=`
    <h2>${q.Subject} - ${q.Lesson}</h2>
    <p>${q.Question}</p>
    <div class="answers">${answers.map(a=>`<button onclick="checkAnswer('${a.replace(/'/g,"\\'")}')">${a}</button>`).join('')}</div>
    <div id="feedback"></div>
  `;
}

function checkAnswer(ans){
  const q=filtered[currentQ];
  const feedback=document.getElementById('feedback');
  if(ans===q.Right){ feedback.innerHTML='âœ… Ø£Ø­Ø³Ù†Øª! '+q.Explanation; score++; }
  else{ feedback.innerHTML='âŒ Ø®Ø·Ø£! '+q.Explanation; wrongQuestions.push({q:q.Question,y:ans,c:q.Right}); }
  document.querySelectorAll('.answers button').forEach(b=>b.disabled=true);
  let next=document.createElement('button'); next.textContent='Ø§Ù„ØªØ§Ù„ÙŠ'; next.onclick=()=>{currentQ++; showQuestion();};
  document.getElementById('quiz').appendChild(next);
}

function showReport(){
  const quizDiv=document.getElementById('quiz');
  const now=new Date().toLocaleString();
  let reports=JSON.parse(localStorage.getItem('quizReports')||'[]');
  const attempt={date:now, subject:selectedSubject, lesson:selectedLesson, score:score, total:filtered.length, wrong:wrongQuestions};
  reports.push(attempt);
  localStorage.setItem('quizReports',JSON.stringify(reports));
  const prevRank=calculateRank(reports.length-1), newRank=calculateRank(reports.length);
  let progress=((reports.length%10)/10)*100;
  if(newRank!==prevRank){ document.getElementById('rankUpSound').play(); }
  quizDiv.innerHTML=`
    <h2>ğŸ“Š Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h2>
    <p>Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <strong>${newRank}</strong></p>
    <div class="progress-bar"><div class="progress-fill" style="width:${progress}%"></div></div>
    <p>Ù†ØªÙŠØ¬ØªÙƒ: ${score} Ù…Ù† ${filtered.length}</p>
    <h3>Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø©:</h3>
    <ul>${wrongQuestions.map(w=>`<li>${w.q}<br>Ø¥Ø¬Ø§Ø¨ØªÙƒ: ${w.y}<br>Ø§Ù„ØµØ­ÙŠØ­Ø©: ${w.c}</li>`).join('')}</ul>
    <button onclick="showSubjectSelect()">Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆØ§Ø¯</button>
    <button onclick="showAllReports()">Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>`;
}

function showAllReports(){
  const quizDiv=document.getElementById('quiz');
  let reports=JSON.parse(localStorage.getItem('quizReports')||'[]');
  let output=`<h2>ğŸ“˜ ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</h2>`;
  subjects.forEach(sub=>{
    output+=`<h3>ğŸ“• Ø§Ù„Ù…Ø§Ø¯Ø©: ${sub}</h3>`;
    const subLessons=[...new Set(questions.filter(q=>q.Subject===sub).map(q=>q.Lesson))];
    subLessons.forEach(les=>{
      output+=`<div class='report-item'><strong>ğŸ“˜ Ø§Ù„Ø¯Ø±Ø³: ${les}</strong><br>`;
      const attempts=reports.filter(r=>r.subject===sub && r.lesson===les);
      if(attempts.length===0) output+="<em>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª</em>";
      else attempts.forEach(a=>{ output+=`<p>ğŸ•’ ${a.date} â€“ Ø§Ù„Ù†ØªÙŠØ¬Ø© ${a.score}/${a.total}</p>`; });
      output+=`</div>`;
    });
  });
  output+='<button onclick="showSubjectSelect()">Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆØ§Ø¯</button>';
  quizDiv.innerHTML=output;
}
loadQuestions();
</script>
</body>
</html>
