<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙƒÙˆÙŠØ² Ù„Ù„Ø£Ø·ÙØ§Ù„</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo&display=swap');
body {
  font-family: 'Cairo', sans-serif;
  background: linear-gradient(to bottom, #fceabb, #f8b500);
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.container {
  width: 95%;
  max-width: 600px;
  margin-top: 20px;
}
.quiz-card {
  background: white;
  border-radius: 15px;
  padding: 20px;
  margin: 20px auto;
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  transition: all 0.5s ease;
  opacity: 1;
}
button {
  background: #ffb600;
  border: none;
  padding: 10px 20px;
  border-radius: 10px;
  cursor: pointer;
  transition: background 0.3s;
  margin-top: 15px;
}
button:hover {
  background: #ffaa00;
}
.answers button {
  display: block;
  width: 100%;
  margin: 10px 0;
}
.feedback {
  margin-top: 15px;
  font-weight: bold;
}
@media (max-width: 500px) {
  .quiz-card { padding: 15px; }
  button { padding: 8px 16px; }
}
select {
  width: 100%;
  padding: 10px;
  margin: 10px 0;
  border-radius: 10px;
  border: 1px solid #ccc;
}
</style>
</head>
<body>
<div class="container">
  <div id="quiz" class="quiz-card">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©...</div>
</div>
<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRcWDsX4R4gqmGyWpFqA7WuzQvI-ajwYIJz12rvyj9fJyJ24FXkvdjlES87PvB0Umb4FpJCFCbCO1n_/pub?gid=0&single=true&output=csv";
let questions = [];
let filteredQuestions = [];
let currentQ = 0;
let score = 0;
let wrongQuestions = [];

async function loadQuestions() {
  try {
    const res = await fetch(csvUrl);
    if(!res.ok) throw new Error('CSV fetch failed');
    const csvText = await res.text();
    const rows = csvText.trim().split("\n").map(r => r.split(","));
    const headers = rows.shift();
    questions = rows.map(row => {
      let q = {};
      headers.forEach((h,i) => q[h.trim()] = row[i] ? row[i].trim() : '');
      return q;
    });
  } catch (error) {
    console.warn('Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ CSVØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©', error);
    questions = [
      {Subject:'Ø±ÙŠØ§Ø¶ÙŠØ§Øª', Lesson:'Ø§Ù„Ø¶Ø±Ø¨', Question:'Ù…Ø§ Ù†Ø§ØªØ¬ 3 Ã— 4 ØŸ', Wrong1:'6', Wrong2:'7', Wrong3:'10', Right:'12', Explanation:'Ù„Ø£Ù† 3 Ù…ÙƒØ±Ø±Ø© 4 Ù…Ø±Ø§Øª = 12', Difficulty:'Ø³Ù‡Ù„'},
      {Subject:'Ø±ÙŠØ§Ø¶ÙŠØ§Øª', Lesson:'Ø§Ù„Ø¶Ø±Ø¨', Question:'Ù…Ø§ Ø­Ø§ØµÙ„ Ø¶Ø±Ø¨ 5 Ã— 6 ØŸ', Wrong1:'20', Wrong2:'25', Wrong3:'40', Right:'30', Explanation:'Ù¥ Ù…ÙƒØ±Ø±Ø© Ù¦ Ù…Ø±Ø§Øª = Ù£Ù ', Difficulty:'Ø³Ù‡Ù„'}
    ];
  }
  showSubjectLessonSelection();
}

function showSubjectLessonSelection() {
  const quizDiv = document.getElementById('quiz');
  const subjects = [...new Set(questions.map(q => q.Subject))];
  quizDiv.innerHTML = '<h2>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ§Ù„Ø¯Ø±Ø³</h2>';
  let html = '<select id="subjectSelect"><option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>';
  subjects.forEach(s => html += `<option value="${s}">${s}</option>`);
  html += '</select>';
  quizDiv.innerHTML += html;

  quizDiv.innerHTML += '<select id="lessonSelect"><option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¯Ø±Ø³</option></select>';
  quizDiv.innerHTML += '<button onclick="startSelectedQuiz()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>';

  document.getElementById('subjectSelect').addEventListener('change', function(){
    const lessons = [...new Set(questions.filter(q => q.Subject===this.value).map(q => q.Lesson))];
    const lessonSelect = document.getElementById('lessonSelect');
    lessonSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¯Ø±Ø³</option>' + lessons.map(l=>`<option value="${l}">${l}</option>`).join('');
  });
}

function startSelectedQuiz() {
  const subject = document.getElementById('subjectSelect').value;
  const lesson = document.getElementById('lessonSelect').value;
  if(!subject || !lesson) { alert('Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ§Ù„Ø¯Ø±Ø³ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©'); return; }
  filteredQuestions = questions.filter(q => q.Subject===subject && q.Lesson===lesson);
  currentQ = 0; score=0; wrongQuestions=[];
  showQuestion();
}

function shuffle(array) {
  for (let i = array.length -1; i>0; i--) {
    const j = Math.floor(Math.random() * (i+1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function showQuestion() {
  const quizDiv = document.getElementById('quiz');
  if (currentQ >= filteredQuestions.length) return showReport();
  const q = filteredQuestions[currentQ];
  const answers = shuffle([q.Right, q.Wrong1, q.Wrong2, q.Wrong3]);
  quizDiv.innerHTML = `
    <h2>${q.Subject} - ${q.Lesson}</h2>
    <p>${q.Question}</p>
    <div class="answers">
      ${answers.map(a => `<button onclick="checkAnswer('${a.replace(/'/g,"\\'")}')">${a}</button>`).join('')}
    </div>
    <div class="feedback" id="feedback"></div>
  `;
}

function checkAnswer(ans) {
  const q = filteredQuestions[currentQ];
  const feedbackDiv = document.getElementById('feedback');
  if (ans === q.Right) {
    feedbackDiv.textContent = 'âœ… Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! ' + q.Explanation;
    score++;
  } else {
    feedbackDiv.textContent = 'âŒ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©! ' + q.Explanation;
    wrongQuestions.push({question: q.Question, yourAnswer: ans, correctAnswer: q.Right});
  }
  document.querySelectorAll('.answers button').forEach(b=>b.disabled=true);
  const nextBtn = document.createElement('button');
  nextBtn.textContent = 'Ø§Ù„ØªØ§Ù„ÙŠ';
  nextBtn.onclick = () => { currentQ++; showQuestion(); };
  document.getElementById('quiz').appendChild(nextBtn);
}

function showReport() {
  const quizDiv = document.getElementById('quiz');
  const now = new Date();
  const attempt = {date: now.toLocaleString(), score: score, total: filteredQuestions.length, wrong: wrongQuestions};
  let reports = JSON.parse(localStorage.getItem('quizReports') || '[]');
  reports.push(attempt);
  localStorage.setItem('quizReports', JSON.stringify(reports));

  quizDiv.innerHTML = `
    <h2>ğŸ“Š Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h2>
    <p>Ù†ØªÙŠØ¬ØªÙƒ: ${score} Ù…Ù† ${filteredQuestions.length}</p>
    <h3>Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø©:</h3>
    <ul>
      ${wrongQuestions.map(w=>`<li>${w.question} - Ø¥Ø¬Ø§Ø¨ØªÙƒ: ${w.yourAnswer} - Ø§Ù„ØµØ­ÙŠØ­Ø©: ${w.correctAnswer}</li>`).join('')}
    </ul>
    <button onclick="showSubjectLessonSelection()">Ø¹ÙˆØ¯Ø© Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</button>
    <button onclick="showAllReports()">Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
  `;
}

function showAllReports() {
  const quizDiv = document.getElementById('quiz');
  let reports = JSON.parse(localStorage.getItem('quizReports') || '[]');
  if (reports.length===0){quizDiv.innerHTML='<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ø¨Ø¹Ø¯.</p>'; return;}
  quizDiv.innerHTML = '<h2>ğŸ“ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</h2>' + reports.map(r=>
    `<p>ØªØ§Ø±ÙŠØ®: ${r.date} - Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${r.score}/${r.total}</p>`).join('') +
    '<button onclick="showSubjectLessonSelection()">Ø¹ÙˆØ¯Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>';
}

loadQuestions();
</script>
</body>
</html>
