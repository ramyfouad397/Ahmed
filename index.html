<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…ÙˆÙ‚Ø¹ Ø£Ø³Ø¦Ù„Ø© Ø£Ø­Ù…Ø¯</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo&display=swap');
body {
  font-family: 'Cairo', sans-serif;
  background: linear-gradient(to bottom, #fceabb, #f8b500);
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.container {
  width: 95%;
  max-width: 600px;
  margin-top: 20px;
}
.quiz-card {
  background: white;
  border-radius: 15px;
  padding: 20px;
  margin: 20px auto;
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  transition: all 0.5s ease;
  opacity: 1;
}
.quiz-card.fade-out {
  opacity: 0;
  transform: translateX(50px);
}
button {
  background: #ffb600;
  border: none;
  padding: 10px 20px;
  border-radius: 10px;
  cursor: pointer;
  transition: background 0.3s;
  margin-top: 15px;
}
button:hover {
  background: #ffaa00;
}
.answers button {
  display: block;
  width: 100%;
  margin: 10px 0;
}
.feedback {
  margin-top: 15px;
  font-weight: bold;
}
@media (max-width: 500px) {
  .quiz-card { padding: 15px; }
  button { padding: 8px 16px; }
}
</style>
</head>
<body>
<div class="container">
  <div id="quiz" class="quiz-card">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©...</div>
</div>
<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRcWDsX4R4gqmGyWpFqA7WuzQvI-ajwYIJz12rvyj9fJyJ24FXkvdjlES87PvB0Umb4FpJCFCbCO1n_/pub?gid=0&single=true&output=csv";
let questions = [];
let currentQ = 0;
let score = 0;
let wrongQuestions = [];

async function loadQuestions() {
  const res = await fetch(csvUrl);
  const csvText = await res.text();
  const rows = csvText.trim().split("\n").map(r => r.split(","));
  const headers = rows.shift();
  questions = rows.map(row => {
    let q = {};
    headers.forEach((h,i) => q[h.trim()] = row[i].trim());
    return q;
  });
  startQuiz();
}

function shuffle(array) {
  for (let i = array.length -1; i>0; i--) {
    const j = Math.floor(Math.random() * (i+1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function startQuiz() {
  currentQ = 0;
  score = 0;
  wrongQuestions = [];
  showQuestion();
}

function showQuestion() {
  const quizDiv = document.getElementById('quiz');
  if (currentQ >= questions.length) return showReport();
  const q = questions[currentQ];
  const answers = shuffle([q.Right, q.Wrong1, q.Wrong2, q.Wrong3]);
  quizDiv.innerHTML = `
    <h2>${q.Subject} - ${q.Lesson}</h2>
    <p>${q.Question}</p>
    <div class="answers">
      ${answers.map(a => `<button onclick="checkAnswer('${a}')">${a}</button>`).join('')}
    </div>
    <div class="feedback" id="feedback"></div>
  `;
}

function checkAnswer(ans) {
  const q = questions[currentQ];
  const feedbackDiv = document.getElementById('feedback');
  if (ans === q.Right) {
    feedbackDiv.textContent = 'âœ… Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! ' + q.Explanation;
    score++;
  } else {
    feedbackDiv.textContent = 'âŒ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©! ' + q.Explanation;
    wrongQuestions.push({question: q.Question, yourAnswer: ans, correctAnswer: q.Right});
  }
  document.querySelectorAll('.answers button').forEach(b=>b.disabled=true);
  const nextBtn = document.createElement('button');
  nextBtn.textContent = 'Ø§Ù„ØªØ§Ù„ÙŠ';
  nextBtn.onclick = () => { currentQ++; showQuestion(); };
  document.getElementById('quiz').appendChild(nextBtn);
}

function showReport() {
  const quizDiv = document.getElementById('quiz');
  const now = new Date();
  const attempt = {date: now.toLocaleString(), score: score, total: questions.length, wrong: wrongQuestions};
  let reports = JSON.parse(localStorage.getItem('quizReports') || '[]');
  reports.push(attempt);
  localStorage.setItem('quizReports', JSON.stringify(reports));

  quizDiv.innerHTML = `
    <h2>ğŸ“Š Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h2>
    <p>Ù†ØªÙŠØ¬ØªÙƒ: ${score} Ù…Ù† ${questions.length}</p>
    <h3>Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø©:</h3>
    <ul>
      ${wrongQuestions.map(w=>`<li>${w.question} - Ø¥Ø¬Ø§Ø¨ØªÙƒ: ${w.yourAnswer} - Ø§Ù„ØµØ­ÙŠØ­Ø©: ${w.correctAnswer}</li>`).join('')}
    </ul>
    <button onclick="startQuiz()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
    <button onclick="showAllReports()">Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
  `;
}

function showAllReports() {
  const quizDiv = document.getElementById('quiz');
  let reports = JSON.parse(localStorage.getItem('quizReports') || '[]');
  if (reports.length===0){quizDiv.innerHTML='<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ø¨Ø¹Ø¯.</p>'; return;}
  quizDiv.innerHTML = '<h2>ğŸ“ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</h2>' + reports.map(r=>
    `<p>ØªØ§Ø±ÙŠØ®: ${r.date} - Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${r.score}/${r.total}</p>`).join('') +
    '<button onclick="startQuiz()">Ø¹ÙˆØ¯Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>';
}

loadQuestions();
</script>
</body>
</html>

